<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Climbing Competition Leaderboard</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
  </style>
</head>
<body>

  <h1>Climbing Competition Leaderboard</h1>
  <table id="leaderboard">
    <thead>
    <th>Timestamp</th>
    <th>Climber</th>
    <th>Route</th>
    <th>Top</th>
    <th>Zone</th>
    <th>Attempts</th>
    </tr>
    </thead>

    <tbody></tbody>
  </table>

  <script>
    const socket = io();
    const tbody = document.querySelector('#leaderboard tbody');

    function sortResults(data) {
      return data.sort((a, b) => {
        const topA = parseInt(a.Top, 10);
        const topB = parseInt(b.Top, 10);
        const zoneA = parseInt(a.Zone, 10);
        const zoneB = parseInt(b.Zone, 10);
        const attemptsA = parseInt(a.Attempts, 10);
        const attemptsB = parseInt(b.Attempts, 10);

        if (topB !== topA) return topB - topA;
        if (zoneB !== zoneA) return zoneB - zoneA;
        return attemptsA - attemptsB;
      });
    }

    async function loadResults() {
      const response = await fetch('/results.json'); // Adjust path if needed
      const data = await response.json();
      const sorted = sortResults(data);

      tbody.innerHTML = ''; // Clear previous rows
      sorted.forEach(entry => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${entry.Timestamp}</td>
          <td>${entry.Climber}</td>
          <td>${entry.Route}</td>
          <td>${entry.Top}</td>
          <td>${entry.Zone}</td>
          <td>${entry.Attempts}</td>
        `;
        tbody.appendChild(row);
      });
    }

    socket.on('newResult', () => {
      loadResults(); // Refresh leaderboard on new submission
    });

    loadResults(); // Initial load
  </script>

</body>
</html>
